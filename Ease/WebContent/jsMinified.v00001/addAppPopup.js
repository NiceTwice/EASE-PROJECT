var addInput=function(e,s,o,t,n,a){var i=this;this.qRoot=$(e),this.name=o,this.qRoot.append('<span class="input '+o+'"><i class="fa '+a+' placeholderIcon" aria-hidden="true"></i></span>'),"password"===t&&$("span.input."+o,this.qRoot).append('<div class="showPassDiv"><i class="fa fa-eye centeredItem" aria-hidden="true"></i><i class="fa fa-eye-slash centeredItem" aria-hidden="true"></i></div>'),$("span.input."+o,this.qRoot).append('<input type="'+t+'" name="'+o+'" id="'+o+'" placeholder="'+n+'"/>'),this.inputField=$("#"+o,this.qRoot),this.inputField.keyup(function(e){13==e.which&&s.submitButton.click()}),this.val=function(){return i.inputField.val()}};addAppPopup=function(e){var s=this;this.qRoot=$(e),this.parentHandler=this.qRoot.closest("#easePopupsHandler"),this.errorRowHandler=this.qRoot.find(".errorHandler"),this.goBackButtonHandler=this.qRoot.find("#goBack"),this.submitButton=this.qRoot.find("button[type='submit']"),this.shortcutLinkButton=this.qRoot.find("#shortcutLink"),this.appNameHolder=this.qRoot.find("input#appName"),this.appNameInTitle=this.qRoot.find(".titleRow p span"),this.appLogoHandler=this.qRoot.find("#appLogo img"),this.loginPasswordRow=this.qRoot.find(".loginPasswordRow"),this.loginInput=this.loginPasswordRow.find("input[name='login']"),this.passwordInput=this.loginPasswordRow.find("input[name='password']"),this.orDelimiter=this.qRoot.find(".orDelimiter"),this.signInChooseRow=this.qRoot.find(".signInChooseRow"),this.signInAccountSelectRow=this.qRoot.find(".signInAccountSelectRow"),this.signInDetectionErrorHandler=this.signInAccountSelectRow.find(".SignInErrorHandler"),this.signInAccountSelectButtonBack=this.signInAccountSelectRow.find(".buttonBack"),this.sameSsoAppsRow=this.qRoot.find(".sameSsoAppsRow"),this.ssoSelectAccountRow=this.qRoot.find(".ssoSelectAccountRow"),this.ssoNewAccountButton=this.ssoSelectAccountRow.find(".newAccountAdder"),this.accountNameHelper=this.qRoot.find(".accountNameHelper"),this.accountNameHelperImg=this.accountNameHelper.find(".accountLogo img"),this.accountNameHelperName=this.accountNameHelper.find(".accountName"),this.accountNameHelperBackButton=this.accountNameHelper.find(".backButton"),this.currentProfile=null,this.currentApp=null,this.shortcutLinkButton.click(function(){s.close(),easeAddBookmarkPopup.open(s.currentApp,s.currentProfile,s.appNameHolder.val()),easeAddBookmarkPopup.goBackButtonHandler.one("click",function(){s.parentHandler.addClass("myshow"),s.qRoot.addClass("show")})}),this.signInAccountSelectRow.find(".selectable").selectable({classes:{"ui-selected":"selected"}}),this.signInAccountSelectButtonBack.click(function(){s.resetSignInAccounts(),s.resetSimpleInputs(),s.submitButton.addClass("locked"),s.signInAccountSelectRow.addClass("hide");for(var e=0;e<s.activeSections.length;e++)s.activeSections[e].removeClass("hide")}),this.choosenSignInName="",this.signInChooseRow.find(".signInButton").click(function(){if(!$(this).hasClass("selected")){s.signInChooseRow.find(".selected").removeClass("selected"),$(this).addClass("selected");var e=catalog.getAppByName($(this).attr("data"));s.choosenSignInName=$(this).attr("data"),s.signInDetectionErrorHandler.removeClass("show"),s.signInDetectionErrorHandler.find("span").text(s.choosenSignInName),s.showSignInAccounts(e.id)}}),this.createSignInSelectorDiv=function(e){var s=$('<div class="accountLine" appId='+e.id+'><div class="checkBoxInput"><span class="fa-stack"><i class="fa fa-square-o fa-stack-2x"></i><i class="fa fa-check fa-stack-1x"></i></span></div><p class="accountName">'+e.getAccountInformationValue("login")+"</p></div>");return s},this.showSignInButtons=function(e){s.signInChooseRow.find(".signInButton").removeClass("show");for(var o,t=0;t<e.length;t++)o=catalog.getAppById(e[t]).name,s.signInChooseRow.find(".signInButton[data="+o+"]").addClass("show")},this.showSignInAccounts=function(e){for(var o=0;o<s.activeSections.length;o++)s.activeSections[o].addClass("hide");var t=s.signInAccountSelectRow.find(".accountsHolder");t.find(".accountLine").remove();for(var n,a=easeAppsManager.getAppsByWebsiteIdNotEmpty(e),o=0;o<a.length;o++)n=s.createSignInSelectorDiv(a[o]),o||(n.addClass("selected"),n.addClass("ui-selected"),n.addClass("ui-selectee")),t.append(n);a.length?s.submitButton.removeClass("locked"):(s.submitButton.addClass("locked"),s.signInDetectionErrorHandler.addClass("show")),s.signInAccountSelectRow.removeClass("hide")},this.activeSections=[],this.createSsoAccountSelectDiv=function(e,s,o){var t=$('<div class="accountLine"><div class="accountLogo"><img src="'+o+'"/></div><p class="accountName">'+s+"</p></div>");return t},this.sameAccountsVar=[],this.createSameAccountDiv=function(e,s){var o=$('<div class="appHandler checkable"><div class="appLogo"><img src="'+e+'"></div><div class="appName"><p>'+s+"</p></div></div>");return o},this.resetSameAccountsRow=function(){for(var e=0;e<s.sameAccountsVar.length;e++)s.sameAccountsVar[e].qRoot.remove();this.sameAccountsVar=[]},this.resetSimpleInputs=function(){s.loginInput.val(""),s.passwordInput.val("")},this.resetSignInAccounts=function(){s.signInAccountSelectRow.find(".accountLine").remove(),s.signInDetectionErrorHandler.removeClass("show"),s.signInChooseRow.find(".selected").removeClass("selected")},this.resetPasswordShows=function(){s.qRoot.find("input[name='password']").attr("type","password"),s.qRoot.find(".showPassDiv.show").removeClass("show")},this.setupSameAccountsDiv=function(e){var o,t=catalog.getAppsBySsoId(e);s.resetSameAccountsRow();var n=s.sameSsoAppsRow.find(".selectHandler");n.find(".appHandler").remove();for(var a=t.length-1;a>=0;a--)t[a].id!=s.currentApp.id&&(o=new Object,o.name=t[a].name,o.ssoId=t[a].ssoId,o.imgSrc=t[a].imgSrc,o.websiteId=t[a].id,o.qRoot=s.createSameAccountDiv(o.imgSrc,o.name),s.sameAccountsVar.push(o));for(var a=0;a<s.sameAccountsVar.length;a++)n.append(s.sameAccountsVar[a].qRoot)},this.choosenSsoAccountLogin=null,this.selectExistingSsoAccounts=function(){for(var e=easeAppsManager.getAppsByLoginAndSsoId(s.choosenSsoAccountLogin,s.currentApp.ssoId),o=0;o<s.sameAccountsVar.length;o++){s.sameAccountsVar[o].qRoot.removeClass("checked"),s.sameAccountsVar[o].qRoot.addClass("checkable");for(var t=0;t<e.length;t++)if(s.sameAccountsVar[o].websiteId==e[t].websiteId){s.sameAccountsVar[o].qRoot.addClass("checked"),s.sameAccountsVar[o].qRoot.removeClass("checkable");break}}},this.accountNameHelperBackButton.click(function(){s.resetSimpleInputs(),s.choosenSsoAccountLogin=null,s.submitButton.addClass("locked"),s.accountNameHelper.addClass("hide"),s.sameSsoAppsRow.addClass("hide"),s.ssoSelectAccountRow.removeClass("hide")}),this.ssoNewAccountButton.click(function(){s.ssoSelectAccountRow.addClass("hide"),s.initializeInputsRow();for(var e=0;e<s.sameAccountsVar.length;e++)s.sameAccountsVar[e].qRoot.addClass("checkable"),s.sameAccountsVar[e].qRoot.removeClass("checked");s.sameSsoAppsRow.removeClass("hide")}),this.setupSsoAccountChooseRow=function(e){var o=s.ssoSelectAccountRow.find(".accountsHolder"),t=o.find(".newAccountAdder");o.find(".accountLine:not(.newAccountAdder)").remove();for(var n,a=s.getLoginList(easeAppsManager.getAppsBySsoId(e.ssoId)),i=catalog.getSsoById(s.currentApp.ssoId),c=0;c<a.length;c++)n=s.createSsoAccountSelectDiv(e.ssoId,a[c],null!=i?i.imgSrc:""),n.click(function(){s.choosenSsoAccountLogin=$(this).find(".accountName").text(),s.accountNameHelperName.text(s.choosenSsoAccountLogin).val(s.choosenSsoAccountLogin),s.accountNameHelperImg.attr("src",$(this).find(".accountLogo img").attr("src")),s.accountNameHelper.removeClass("hide"),s.setupSameAccountsDiv(e.ssoId),s.selectExistingSsoAccounts(),s.sameSsoAppsRow.removeClass("hide"),s.ssoSelectAccountRow.addClass("hide"),s.submitButton.removeClass("locked")}),t.before(n)},this.getLoginList=function(e){for(var s=[],o=0;o<e.length;o++)-1==s.indexOf(e[o].getAccountInformationValue("login"))&&s.push(e[o].getAccountInformationValue("login"));return s},this.open=function(e,o){currentEasePopup=s,s.reset(),s.currentApp=e,s.currentProfile=o,s.setName(e.name),s.appLogoHandler.attr("src",e.imgSrc),e.canLoginWith.length&&(s.showSignInButtons(e.canLoginWith),s.signInChooseRow.removeClass("hide"),s.orDelimiter.removeClass("hide"),s.activeSections.push(s.orDelimiter)),-1==e.ssoId?(s.loginPasswordRow.removeClass("hide"),s.initializeInputsRow(),s.activeSections.push(s.loginPasswordRow)):(s.setupSameAccountsDiv(e.ssoId),easeAppsManager.getAppsBySsoId(e.ssoId).length?(s.setupSsoAccountChooseRow(e),s.ssoSelectAccountRow.removeClass("hide"),s.activeSections.push(s.ssoSelectAccountRow)):(s.loginPasswordRow.removeClass("hide"),s.initializeInputsRow(),s.sameSsoAppsRow.removeClass("hide"),s.activeSections.push(s.loginPasswordRow))),s.parentHandler.addClass("myshow"),s.qRoot.addClass("show")},this.currentInputs=[],this.initializeInputsRow=function(){s.loginPasswordRow.removeClass("hide"),s.currentApp.inputs.forEach(function(e){s.currentInputs.push(new addInput(s.loginPasswordRow,s,e.name,e.type,e.placeholder,e.placeholderIcon))}),$("input",s.loginPasswordRow).on("input",function(){s.checkInputsRow()?s.submitButton.removeClass("locked"):s.submitButton.addClass("locked")})},this.resetInputsRow=function(){$(".input",s.loginPasswordRow).remove(),s.currentInputs=[]},this.checkInputsRow=function(){for(var e=0;e<s.currentInputs.length;e++)if(!s.currentInputs[e].val().length)return!1;return!0},this.close=function(){s.qRoot.removeClass("show"),s.parentHandler.removeClass("myshow")},this.reset=function(){s.currentProfile=null,s.currentApp=null,s.activeSections=[],s.choosenSsoAccountLogin=null,s.resetSimpleInputs(),s.resetSameAccountsRow(),s.resetSignInAccounts(),s.resetPasswordShows(),s.submitButton.addClass("locked"),s.errorRowHandler.removeClass("show"),s.loginPasswordRow.addClass("hide"),s.signInChooseRow.addClass("hide"),s.signInAccountSelectRow.addClass("hide"),s.sameSsoAppsRow.addClass("hide"),s.ssoSelectAccountRow.addClass("hide"),s.orDelimiter.addClass("hide"),s.accountNameHelper.addClass("hide"),s.resetInputsRow()},this.setName=function(e){s.appNameHolder.val(e),s.appNameInTitle.text(e)},this.submitButton.click(function(){s.errorRowHandler.removeClass("show");var e=s.appNameHolder.val(),o=s.currentProfile.id,t=s.signInAccountSelectRow.find(".selected"),n=t.length?$(t[0]).attr("appid"):"",a=[],i=[],c=easeAppsManager.getAppByLoginAndSsoId(s.choosenSsoAccountLogin,s.currentApp.ssoId);null!=c&&i.push({name:"login",value:s.choosenSsoAccountLogin});var r=null!=c?c.id:"";a.push(s.currentApp.id.toString());for(var d=0;d<s.sameAccountsVar.length;d++)s.sameAccountsVar[d].qRoot.hasClass("checkable")&&s.sameAccountsVar[d].qRoot.hasClass("checked")&&a.push(s.sameAccountsVar[d].websiteId.toString());var l="AddClassicApp";if(n.length&&(l="AddLogwithApp"),null!=s.choosenSsoAccountLogin&&(l="AddClassicAppSameAs"),"AddClassicApp"!=l||s.checkInputsRow()){s.submitButton.addClass("loading");var u=JSON.stringify(a),p={name:e,profileId:o,websiteIds:u,logwithId:n,appId:r};s.currentInputs.forEach(function(e){if(p[e.name]=e.val(),"password"!=e.name){var s={};s.name=e.name,s.value=e.val(),i.push(s)}}),postHandler.post(l,p,function(){s.submitButton.removeClass("loading")},function(o){for(var t,c=JSON.parse(o),r=0;r<c.length;++r){t=catalog.getAppById(a[r]);var d=new MyApp;d.init(n,i,t.id,0==r?e:t.name,c[r],t.ssoId,!0,t.imgSrc,""),t.increaseCount(),s.currentProfile.addApp(d),d.scaleAnimate()}s.close()},function(e){s.errorRowHandler.find("p").text(e),s.errorRowHandler.addClass("show"),setTimeout(function(){s.errorRowHandler.removeClass("show")},3e3)},"text")}}),this.goBackButtonHandler.click(function(){s.close()})};var easeAddAppPopup;$(document).ready(function(){easeAddAppPopup=new addAppPopup($("#addAppPopup"))});