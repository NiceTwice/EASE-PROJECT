var constructorForm=function(t,e){var s=this;this.qRoot=t,this.oParent=e,this.oInputs=[],this.params={},this.qRoot.find("input").each(function(t,e){this.oErrorMsg;var a=$(e).attr("oClass");null!=a&&s.oInputs.push(new Input[a]($(e),s))}),this.qRoot.find("div").each(function(t,e){var a=$(e).attr("oClass");null!=a&&(s.oErrorMsg=new ErrorMsg[a]($(e),s))}),this.qButton=this.qRoot.find("button[type='submit']"),this.qButton.click(function(t){s.submit(t)}),this.isEnabled=!1;for(var a=0;a<this.oInputs.length;++a)this.oInputs[a].listenBy(this.qRoot);s.isEnabled=!1,s.qButton.prop("disabled",!0),s.qButton.removeClass("Active"),this.enable=function(){s.isEnabled=!0,s.qButton.prop("disabled",!1),s.qButton.addClass("Active")},this.disable=function(){s.isEnabled=!1,s.qButton.prop("disabled",!0),s.qButton.removeClass("Active")},this.qRoot.on("StateChanged",function(){s.checkInputs()?s.enable():s.disable()}),this.checkInputs=function(){for(var t=0;t<s.oInputs.length;++t)if(0==s.oInputs[t].isValid)return!1;return!0},this.findByName=function(t){var e=null;return s.oInputs.forEach(function(s){return s.qInput.attr("name")==t?void(e=s.qInput):void 0}),e},this.reset=function(){s.disable();for(var t=0;t<s.oInputs.length;++t)s.oInputs[t].reset();s.afterReset()},this.afterReset=function(){},this.submit=function(t){t.preventDefault(),s.oInputs.forEach(function(t){s.params[t.qInput.attr("name")]=t.getVal()}),s.beforeSubmit(),postHandler.post(s.qRoot.attr("action"),s.params,s.afterSubmit,s.successCallback,s.errorCallback)},this.beforeSubmit=function(){},this.afterSubmit=function(){},this.successCallback=function(){},this.errorCallback=function(){}},Form={EditUserNameForm:function(){constructorForm.apply(this,arguments);var t=this;this.successCallback=function(){var e=t.oInputs[0].getVal();$("#userSettingsButton span").html(e);var s=e.split(" ").length;easeTracker.trackEvent("SettingsEditUserName",{UserNamesCount:s}),t.disable()},this.errorCallback=function(){$(".errorMessage",t.qRoot).addClass("show")}},EditUserPasswordForm:function(){constructorForm.apply(this,arguments);var t=this;this.successCallback=function(e){easeTracker.trackEvent("SettingsEditUserPassword"),$("p.response",t.qRoot).removeClass("error"),$("p.response",t.qRoot).addClass("success"),$("p.response",t.qRoot).text(e)},this.errorCallback=function(e){$("p.response",t.qRoot).removeClass("success"),$("p.response",t.qRoot).addClass("error"),$("p.response",t.qRoot).text(e)},this.afterSubmit=function(){t.reset()}},AddAppForm:function(){constructorForm.apply(this,arguments);var t=this;this.newAppItem=null,this.appsContainer=null,this.helper=null,this.attributesToSet={},this.site_id=null,this.profile_id=null,this.app_id=null,this.postName="AddClassicApp",this.helper=null,this.setHelper=function(e){t.helper=e,t.site_id=t.helper.attr("idx");var s=e.attr();for(var a in s)if(s.hasOwnProperty(a))switch(a){case"team":var i=($(".classicLogin",t.qRoot).append("<input type='"+s[a]+"' name='"+a+"' oClass='NoEmptyInput' placeholder='Team name' />"),new Input.NoEmptyInput($("input[name='"+a+"']",t.qRoot),t));i.listenBy(t.qRoot),t.oInputs.push(i)}t.checkInputs()},this.setAppsContainer=function(e){t.appsContainer=e,t.profile_id=t.appsContainer.closest(".item").attr("id")},this.setNewAppItem=function(e){t.newAppItem=e},this.removeAddedFields=function(){t.oInputs.forEach(function(e){if("login"!=e.qInput.attr("name")&&"password"!=e.qInput.attr("name")&&"name"!=e.qInput.attr("name")){e.qInput.remove();var s=t.oInputs.indexOf(e);t.oInputs.splice(s,1)}})},this.afterReset=function(){t.removeAddedFields()},this.beforeSubmit=function(){t.oParent.close(),t.appsContainer.append(t.newAppItem),t.params={profileId:t.profile_id,websiteId:t.site_id,logwithId:t.app_id},t.oInputs.forEach(function(e){var s=e.qInput.attr("name"),a=e.qInput.val();t.params[s]=a,"password"!=s&&(t.attributesToSet[s]=a)})},this.afterSubmit=function(){t.removeAddedFields()},this.successCallback=function(e){var s=parseInt($(".catalogApp[idx='"+t.site_id+"'] span.apps-integrated i.count").html());$(".catalogApp[idx='"+t.site_id+"'] span.apps-integrated i.count").html(s+1),$(".catalogApp[idx='"+t.site_id+"'] span.apps-integrated").addClass("showCounter"),t.newAppItem.find(".linkImage").addClass("scaleOutAnimation"),setTimeout(function(){t.newAppItem.find(".linkImage").removeClass("scaleOutAnimation"),t.newAppItem=null},1e3),t.newAppItem.find(".linkImage").attr("onclick","sendEvent(this)"),t.newAppItem.attr("webId",t.helper.attr("idx")),t.newAppItem.attr("logwith",null==t.app_id?"false":t.app_id);var a=t.oInputs[0].getVal();t.newAppItem.find(".siteName p").text(a),t.newAppItem.attr("id",e),t.newAppItem.attr("ssoid",t.helper.attr("data-sso"));for(var i in t.attributesToSet)t.attributesToSet.hasOwnProperty(i)&&"password"!=i&&t.newAppItem.attr(i,t.attributesToSet[i]);var o="AddClassicApp"==t.postName?"ClassicApp":"LogWithApp",n=null!=$(".catlogApp[name='"+a+"']").attr("newApp");easeTracker.trackEvent("AddApp",{appType:o,appName:a,AppNewYN:n}),easeTracker.increaseAppCounter(),t.reset(),t.appsContainer=null,t.helper=null,t.attributesToSet={},t.site_id=null,t.profile_id=null,t.app_id=null,t.setPostName("AddClassicApp"),t.helper=null,cleanEmails()},this.errorCallback=function(e){t.newAppItem.remove(),t.reset(),$(parent).find(".alertDiv").addClass("show"),showAlertPopup(e,!0)},this.setPostName=function(e){t.postName=e,t.qRoot.attr("action",t.postName),t.qRoot.trigger("StateChanged")},this.checkInputs=function(){if("AddClassicApp"!=t.postName)return!0;for(var e=0;e<t.oInputs.length;++e)if(0==t.oInputs[e].isValid)return!1;return!0},t.oInputs[1].onEnter(function(e){e.preventDefault(),t.oInputs[2].focus()})},DeleteProfileForm:function(){constructorForm.apply(this,arguments);var t=this;this.beforeSubmit=function(){$("#loading").addClass("la-animate")},this.afterSubmit=function(){$("#loading").removeClass("la-animate"),t.qRoot.find(".AccountApp.selected").removeClass("selected")},this.successCallback=function(){t.oParent.close(),t.oParent.targetProfile.remove()},this.errorCallback=function(t){$(parent).find(".alertDiv").addClass("show"),$(parent).find("#password").val(""),showAlertPopup(t,!0)}},ModifyAppForm:function(){constructorForm.apply(this,arguments);var t=this;this.oPopup=null,this.app=null,this.password=null,this.appId=null,this.aId=null,this.attributesToSet={},this.setApp=function(e){t.app=e,t.appId=t.app.attr("id"),t.aId=t.app.attr("aid");var s=e.attr();for(var a in s)if(s.hasOwnProperty(a))switch(a){case"login":t.oInputs[1].val(s[a]);break;case"name":t.oInputs[0].val(s[a]);break;case"team":var i=$(".classicLogin input[name='"+a+"']",t.qRoot);if(i.length)i.val(s[a]),i.change();else{var o=($(".classicLogin",t.qRoot).append("<input type='"+s[a]+"' name='"+a+"' oClass='NoEmptyInput' placeholder='Team name' />"),new Input.NoEmptyInput($("input[name='"+a+"']",t.qRoot),t));o.listenBy(t.qRoot),t.oInputs.push(o),o.val(s[a])}}},this.removeAddedFields=function(){t.oInputs.forEach(function(e){if("login"!=e.qInput.attr("name")&&"password"!=e.qInput.attr("name")&&"name"!=e.qInput.attr("name")){e.qInput.remove();var s=t.oInputs.indexOf(e);t.oInputs.splice(s,1)}})},this.afterReset=function(){t.removeAddedFields()},this.submit=function(e){e.preventDefault();var s=t.oInputs[0].getVal();t.params={name:s,appId:t.appId};var a=t.qRoot.find(".AccountApp.selected");if(a.length){t.params.logwithId=a.attr("aid");var i="EditLogwithApp";t.app.hasClass("emptyApp")&&(i="WebsiteAppToLogwithApp"),postHandler.post(i,t.params,function(){},function(e){var s=(e.substring(4),t.app.find(".linkImage"));t.oParent.close(),s.addClass("scaleOutAnimation"),setTimeout(function(){s.removeClass("scaleOutAnimation")},1e3);for(var a in t.attributesToSet)t.attributesToSet.hasOwnProperty(a)&&t.app.attr(a,t.attributesToSet[a]);t.app.attr("logwith",t.params.logwithId),t.app.find(".siteName p").text(t.oInputs[0].getVal()),t.app.find(".emptyAppIndicator").remove(),t.app.removeClass("emptyApp"),t.qRoot.find(".AccountApp.selected").removeClass("selected"),easeTracker.trackEvent("EditAppDone"),t.removeAddedFields()},function(){},"text")}else{t.oInputs.forEach(function(e){var s=e.qInput.attr("name"),a=e.qInput.val();t.params[s]=a,"password"!=s?t.attributesToSet[s]=a:null!=a&&""!=a&&(t.password=a)}),null!=t.password&&(t.params.password=t.password);for(var o in t.attributesToSet)t.attributesToSet.hasOwnProperty(o)&&(t.params[o]=t.attributesToSet[o]);var i="EditClassicApp";t.app.hasClass("emptyApp")&&(i="WebsiteAppToClassicApp"),console.log("modify"),postHandler.post(i,t.params,function(){},function(e){var s=(e.substring(4),t.app.find(".linkImage"));t.oParent.close(),s.addClass("scaleOutAnimation"),setTimeout(function(){s.removeClass("scaleOutAnimation")},1e3);for(var a in t.attributesToSet)t.attributesToSet.hasOwnProperty(a)&&t.app.attr(a,t.attributesToSet[a]);t.app.attr("logwith","false"),t.app.find(".siteName p").text(t.oInputs[0].getVal()),t.app.find(".emptyAppIndicator").remove(),t.app.removeClass("emptyApp"),console.log(t.params.login),t.qRoot.find(".AccountApp.selected").removeClass("selected"),t.removeAddedFields(),cleanEmails()},function(){},"text")}}},DeleteAppForm:function(){constructorForm.apply(this,arguments);var t=this;this.beforeSubmit=function(){$(t.oParent.app).find(".linkImage").addClass("easyScaling")},this.afterSubmit=function(){t.oParent.close(),$(t.oParent.app).find(".linkImage").removeClass("easyScaling")},this.successCallback=function(){var e=t.oParent.app.attr("webid"),s=parseInt($(".catalogApp[idx='"+e+"'] span.apps-integrated i.count").html());$(".catalogApp[idx='"+e+"'] span.apps-integrated i.count").html(s-1);var a=$(t.oParent.app).attr("name");easeTracker.trackEvent("DeleteApp",{appName:a}),easeTracker.decreaseAppCounter(),1==s&&$(".catalogApp[idx='"+e+"'] span.apps-integrated").removeClass("showCounter"),$(t.oParent.app).find(".linkImage").addClass("deletingApp"),setTimeout(function(){t.oParent.app.remove()},500),cleanEmails()},this.errorCallback=function(t){showAlertPopup(t,!0)}},AddEmailForm:function(){constructorForm.apply(this,arguments);var t=this;this.addEmail=function(t){$("#editVerifiedEmails").append("<div class='emailLine'><input type='email' name='email' oClass='HiddenInput' value='"+t+'\'readonly /> <span class=\'unverifiedEmail\'><span class=\'verify\'>Verified ?</span><span class=\'sendVerificationEmail\'>Send verification email</span></span><div class=\'sk-fading-circle email-loading\'>	<span>We are sending you an email</span>	<div class=\'sk-circle1 sk-circle\'></div>	<div class="sk-circle2 sk-circle"></div>	<div class="sk-circle3 sk-circle"></div>	<div class="sk-circle4 sk-circle"></div>	<div class="sk-circle5 sk-circle"></div>	<div class="sk-circle6 sk-circle"></div>	<div class="sk-circle7 sk-circle"></div>	<div class="sk-circle8 sk-circle"></div>	<div class="sk-circle9 sk-circle"></div> <div class="sk-circle10 sk-circle"></div>	<div class="sk-circle11 sk-circle"></div>	<div class="sk-circle12 sk-circle"></div></div></div>'),$(".suggested-emails").append("<p class='email-suggestion' email='"+t+"'><span>"+t+"</span></p>")},this.beforeSubmit=function(){$("#AddEmailPopup").addClass("md-show"),$("#AddEmailPopup .waiting").addClass("show")},this.successCallback=function(){$("#AddEmailPopup .waiting").removeClass("show"),$("#AddEmailPopup .email-sent").addClass("show"),setTimeout(function(){$("#AddEmailPopup").removeClass("md-show"),$("#AddEmailPopup .waiting, #AddEmailPopup .email-sent").removeClass("show")},2e3),t.addEmail(t.oInputs[0].getVal()),$(".newEmail").addClass("show"),$(".newEmailInput").removeClass("show"),easeTracker.trackEvent("EmailAdded"),easeTracker.increaseEmailCount(),t.reset()}},DeleteEmailForm:function(){constructorForm.apply(this,arguments);var t=this;this.successCallback=function(){$(".emailLine input[value='"+t.oInputs[0].getVal()+"']").parent().remove(),$(".email-suggestion[email='"+t.oInputs[0].getVal()+"']").remove();var e=$(".verifiedEmail").length;$(".integrated-emails-count span").html(e>1?e+" validated emails":e+" validated email"),t.reset(),t.oParent.close()}},SendVerificationEmailForm:function(){constructorForm.apply(this,arguments);var t=this;this.setEmail=function(e){t.oInputs[0].val(e)},this.beforeSubmit=function(){$(".emailLine").has("input[value='"+t.oInputs[0].getVal()+"']").find(".unverifiedEmail").addClass("wait"),$(".emailLine").has("input[value='"+t.oInputs[0].getVal()+"']").find(".email-loading").addClass("show")},this.afterSubmit=function(){setTimeout(function(){$(".emailLine").has("input[value='"+t.oInputs[0].getVal()+"']").find(".email-loading").removeClass("show"),$(".emailLine").has("input[value='"+t.oInputs[0].getVal()+"']").find(".email-sent").addClass("show")},2e3)},this.successCallback=function(){easeTracker.trackEvent("EmailVerificationSent")}},DeleteAccountForm:function(){constructorForm.apply(this,arguments);var t=this;this.beforeSubmit=function(){t.qRoot.removeClass("show"),$("#DeleteAccountWait").addClass("md-show"),$(".wait",t.oParent.qRoot).addClass("show")},this.successCallback=function(){easeTracker.trackEvent("SettingsEaseAccountDeleted"),setTimeout(function(){window.location="index.jsp"},1e3)},this.errorCallback=function(){$(".wait",t.oParent.qRoot).removeClass("show"),t.qRoot.addClass("show"),$(".errorMessage",t.oParent.qRoot).addClass("show")}},AddUpdateForm:function(){constructorForm.apply(this,arguments);var t=this;this.beforeSubmit=function(){},this.successCallback=function(e){t.oParent.close(),profiles.forEach(function(s){s.id==t.params.profileId&&(s.addApp(t.params.login,t.params.siteId,t.params.name,e,"",!1,t.qRoot.find("img").attr("src")),console.log(t.oParent.updateIndex),catalog.oUpdate.updates[t.oParent.updateIndex].remove())})},this.errorCallback=function(e){t.oParent.error.html(e)}},RegisterForm:function(){constructorForm.apply(this,arguments);var t=this;this.email=$("input[name='email']",t.qRoot).val(),this.invitationCode=$("input[name='invitationCode']",t.qRoot).val(),this.params={email:t.email,invitationCode:t.invitationCode},this.beforeSubmit=function(){$(".successHelper",t.qRoot).removeClass("success"),$(".errorHelper",t.qRoot).removeClass("error"),$(".loadHelper, button[type='submit']",t.qRoot).addClass("loading")},this.successCallback=function(e){$(".loadHelper",t.qRoot).removeClass("loading"),$(".successHelper p",t.qRoot).text(e),$(".successHelper",t.qRoot).addClass("success"),setTimeout(function(){window.location="index.jsp"},750)},this.errorCallback=function(e){$(".loadHelper, button[type='submit']",t.qRoot).removeClass("loading"),$(".errorHelper p",t.qRoot).text(e),$(".errorHelper",t.qRoot).addClass("error")}},GetEmailForm:function(){constructorForm.apply(this,arguments);var t=this;this.beforeSubmit=function(){$(".loadHelper",t.qRoot).addClass("loading"),$(".errorHelper",t.qRoot).removeClass("error"),$(".successHelper",t.qRoot).removeClass("success"),t.qRoot.addClass("loading")},this.successCallback=function(e){$(".loadHelper",t.qRoot).removeClass("loading"),t.qRoot.removeClass("loading"),$(".successHelper p",t.qRoot).text(e),$(".successHelper",t.qRoot).addClass("success"),t.reset()},this.errorCallback=function(e){$(".loadHelper",t.qRoot).removeClass("loading"),t.qRoot.removeClass("loading"),$(".errorHelper p",t.qRoot).text(e),$(".errorHelper",t.qRoot).addClass("error"),t.reset()}},ChangePositionForm:function(){constructorForm.apply(this,arguments);var t=this;this.jqSites=$(".movable-sites"),this.siteToMove=null,t.enable(),this.setPostName=function(e){t.qRoot.attr("action",e)},this.setSiteToMove=function(e){t.siteToMove=e,t.params.siteId=e.attr("siteId"),t.params.position=e.attr("position")},this.increaseWebsitesPositions=function(e,s){for(var a=e;s>a;a++)$(".website[position='"+a+"']",t.jqSites).attr("position",a+1)},this.decreaseWebsitesPositions=function(e,s){for(var a=e;s>a;a++)$(".website[position='"+a+"']",t.jqSites).attr("position",a-1)},this.successCallback=function(){var e=parseInt($(".website-position",t.siteToMove).text());switch(t.qRoot.attr("action")){case"goTop":t.increaseWebsitesPositions(1,e),$(".website-position",t.siteToMove).text("1"),t.siteToMove.attr("position","1"),t.jqSites.prepend(t.siteToMove);break;case"top":var s=$(".website[position='"+(e-1)+"']",t.jqSites);s.insertAfter(t.siteToMove),s.attr("position",e),$(".website-position",s).text(e),$(".website-position",t.siteToMove).text(e-1),t.siteToMove.attr("position",e-1);break;case"down":var s=$(".website[position='"+(e+1)+"']",t.jqSites);s.insertBefore(t.siteToMove),s.attr("position",e),$(".website-position",s).text(e),$(".website-position",t.siteToMove).text(e+1),t.siteToMove.attr("position",e+1);break;case"goDown":var a=parseInt(t.jqSites.last().attr("position"));t.decreaseWebsitesPositions(e+1,a),$(".website-position",t.siteToMove).text(a),t.siteToMove.attr("position",a),t.jqSites.append(t.siteToMove)}}}};